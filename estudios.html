<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Estudios Médicos</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="nav-left">
    <span>Laboratorio Clínico BioTEC</span>    
    <img src="/img/logo.png" alt="Logo" class="logo">
  </div>

  <div class="nav-right" id="menu">
    <!-- menú dinámico -->
  </div>
</nav>

<!-- MENÚ DINÁMICO -->
<script>
  fetch('/menu')
    .then(res => {
      if (!res.ok) throw new Error('No autorizado');
      return res.json();
    })
    .then(menu => {
      const contenedor = document.getElementById('menu');
      contenedor.innerHTML = '';

      menu.forEach(item => {
        const link = document.createElement('a');
        link.href = item.url;
        link.textContent = item.nombre;
        contenedor.appendChild(link);
      });
    })
    .catch(() => {
      window.location.href = '/login.html';
    });
</script>

<!-- CONTENIDO -->
<div class="main">
  <h2>Estudios Médicos Disponibles</h2>

  <!-- BOTÓN ADMIN -->
  <div id="admin-actions" style="margin-bottom: 20px;"></div>

  <div id="lista-estudios" class="cards-container"></div>
</div>

<!-- SCRIPT ESTUDIOS -->
<script>
Promise.all([
  fetch('/estudios/lista').then(res => res.json()),
  fetch('/session').then(res => res.json())
]).then(([estudios, usuario]) => {

  const contenedor = document.getElementById('lista-estudios');
  const adminActions = document.getElementById('admin-actions');

  /* BOTÓN AGREGAR SOLO ADMIN */
  if (usuario.rol === 'admin') {
    adminActions.innerHTML = `
      <a href="/estudios/nuevo" class="btn btn-primary">
        + Agregar estudio
      </a>
    `;
  }

  contenedor.innerHTML = estudios.map(e => `
    <div class="card">
      <h3>${e.nombre}</h3>
      <p>${e.descripcion || ''}</p>
      <strong>Precio: $${e.precio}</strong>

      ${
        usuario.rol === 'admin'
          ? `
            <div style="margin-top:10px;">
              <a href="/estudios/editar/${e.id}" class="btn btn-secondary">
                Editar
              </a>
            </div>
          `
          : ''
      }
    </div>
  `).join('');
});
</script>

</body>
</html>
