<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscar estudios</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<nav class="navbar">
  <div class="nav-left">
    <span>Laboratorio Clínico BioTEC</span>
    <img src="/img/logo.png" class="logo">
  </div>
  <div class="nav-right" id="menu"></div>
</nav>

<main class="main">
  <h2>Buscar estudios</h2>

  <input type="text" id="busqueda" placeholder="Buscar estudio...">

  <div id="resultados"></div>
</main>

<script>
/* MENÚ */
fetch('/menu')
  .then(res => res.json())
  .then(menu => {
    const cont = document.getElementById('menu');
    menu.forEach(i => {
      const a = document.createElement('a');
      a.href = i.url;
      a.textContent = i.nombre;
      cont.appendChild(a);
    });
  });

/* BUSQUEDA EN TIEMPO REAL */
document.getElementById('busqueda').addEventListener('input', e => {
  fetch('/estudios/buscar?q=' + e.target.value)
    .then(res => res.json())
    .then(estudios => {
      const div = document.getElementById('resultados');
      div.innerHTML = '';

      estudios.forEach(estudio => {
        div.innerHTML += `
          <div class="card">
            <h3>${estudio.nombre}</h3>
            <p>${estudio.descripcion}</p>
            <p><strong>$${estudio.precio}</strong></p>

            <form action="/citas/agendar" method="POST">
              <input type="hidden" name="estudio_id" value="${estudio.id}">
              <input type="date" name="fecha" required>
              <input type="time" name="hora" required>
              <button type="submit">Agendar cita</button>
            </form>
          </div>
        `;
      });
    });
});
</script>

</body>
</html>
